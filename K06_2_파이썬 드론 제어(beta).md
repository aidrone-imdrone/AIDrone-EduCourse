# PyAIDrone 확장 라이브러리

PyAIDrone 라이브러리를 위한 확장 모듈과 예제 코드입니다. 이 저장소는 드론 상태 관리, 자율 비행 계획, 센서 데이터 처리, 컴퓨터 비전 기능을 추가합니다.

## 설치 방법

기본 PyAIDrone 라이브러리가 설치되어 있어야 합니다:

```bash
pip install pyaidrone
```

## 확장 모듈

이 저장소는 다음과 같은 확장 모듈을 추가합니다:

1. **DroneState**: 드론의 비행 상태, 배터리, 센서 데이터 등을 추적하고 관리
2. **FlightPlan**: 자율 비행을 위한 웨이포인트 계획 생성 및 실행
3. **Sensors**: 다양한 센서 데이터 처리 및 필터링
4. **Vision**: 카메라 기반 객체 감지 및 추적 시스템

## 예제 프로그램

### 1. DroneState 사용 예제 (drone_state_example.py)

드론의 상태 정보(비행 상태, 배터리, 고도, 방향 등)를 모니터링하는 예제입니다.

**사용법:**
```bash
python examples/drone_state_example.py
```

**주요 기능:**
- 드론 상태 데이터 실시간 수신 및 처리
- 드론의 비행 상태, 고도, 배터리, 방향 정보 출력
- 간단한 비행 시퀀스 실행 (이륙, 고도 변경, 회전, 전진, 착륙)

**설정 변경:**
- `aidrone.Open("COM3")` 부분에서 COM 포트 번호를 실제 드론이 연결된 포트로 변경하세요.

### 2. FlightPlan 사용 예제 (flight_plan_example.py)

미리 정의된 비행 계획을 생성하고 실행하는 예제입니다.

**사용법:**
```bash
python examples/flight_plan_example.py
```

**주요 기능:**
- 정사각형 패턴의 비행 계획 생성
- 웨이포인트 도달, 계획 완료, 오류 발생 시 콜백 함수 실행
- 비행 계획 파일로 저장 (`square_pattern.json`)
- 그리드 패턴 비행 계획 생성 예시

**설정 변경:**
- 비행 고도, 이동 거리, 웨이포인트 간격 등을 실제 환경에 맞게 조정하세요.

### 3. Sensors 사용 예제 (sensors_example.py)

센서 데이터를 처리하고 특정 이벤트에 대응하는 예제입니다.

**사용법:**
```bash
python examples/sensors_example.py
```

**주요 기능:**
- 센서 데이터 처리 (실제 또는 시뮬레이션)
- 장애물 감지, 배터리 부족, 센서 오류 등의 이벤트 처리
- 주기적인 센서 데이터 출력

**참고:**
- 예제 코드는 시뮬레이션된 센서 데이터를 사용할 수 있습니다. 실제 드론에서는 드론에서 받은 패킷으로 데이터를 업데이트합니다.

### 4. Vision 사용 예제 (vision_example.py)

드론의 카메라를 통한 영상 처리 및 객체 감지 예제입니다.

**사용법:**
```bash
python examples/vision_example.py
```

**주요 기능:**
- 화살표, 색상 블롭, 선 감지 기능
- 감지된 객체에 따른 드론 제어
- 영상 처리 결과 시각화 및 프레임 저장

**키보드 컨트롤:**
- ESC: 종료
- ENTER: 이륙
- SPACE: 착륙
- A: 화살표 감지 켜기/끄기
- C: 색상 감지 켜기/끄기
- L: 선 감지 켜기/끄기
- S: 현재 프레임 저장

**설정 변경:**
- 카메라 소스를 실제 환경에 맞게 조정하세요:
  - 라즈베리파이 카메라: `camera_src="http://192.168.1.15/?action=stream"`
  - 웹캠: `camera_src=0`

### 5. 통합 시스템 예제 (integrated_drone_system.py)

위의 모든 기능들을 하나의 통합 시스템으로 결합한 예제입니다.

**사용법:**
```bash
python examples/integrated_drone_system.py
```

**주요 기능:**
- 드론 상태 모니터링, 센서 처리, 비전 시스템, 비행 계획 모두 통합
- 수동 모드와 자율 비행 모드 전환
- 키보드를 통한 대화형 제어
- 로그 파일 생성 및 스냅샷 저장

**키보드 컨트롤:**
- ESC: 종료
- ENTER: 이륙
- SPACE: 착륙
- 방향키: 이동
- W/X: 고도 증가/감소
- A/D: 좌/우 회전
- S: 스냅샷 촬영
- F: 자율 비행 시작
- M: 수동/자율 모드 전환
- 1-3: 화살표/색상/선 감지 켜기/끄기

**설정 변경:**
- `drone_port`와 `camera_src` 매개변수를 실제 환경에 맞게 조정하세요.

## 일반적인 설정 및 주의사항

1. **포트 설정**: 
   - 모든 예제에서 `COM3` 대신 실제 드론이 연결된 COM 포트를 사용하세요.

2. **카메라 설정**:
   - 라즈베리파이 카메라: URL을 올바른 스트리밍 주소로 변경하세요.
   - 웹캠: 일반적으로 `0`이나 `1`을 사용하지만, 시스템에 따라 다를 수 있습니다.

3. **드론 설정**:
   - 실제 드론의 성능과 제한에 맞게 이동 속도, 회전 각도, 고도 등을 조정하세요.

4. **안전 고려사항**:
   - 항상 넓고 안전한 공간에서 테스트하세요.
   - 비상 착륙을 위한 준비를 항상 하세요(SPACE 키).
   - 처음에는 낮은 고도와 속도로 테스트하세요.

## 종속성

이 라이브러리는 다음 패키지에 의존합니다:
- pyaidrone (기본 드론 제어 라이브러리)
- opencv-python (비전 시스템용)
- numpy
- pynput (키보드 입력 처리용)

## 라이센스

[MIT 라이센스](LICENSE)

## 기여하기

버그 보고서나 기능 요청은 이슈 트래커에 제출해 주세요. 풀 리퀘스트도 환영합니다.

## 추가 문서

- [DroneState 모듈 문서](docs/dronestate.md)
- [FlightPlan 모듈 문서](docs/flightplan.md)
- [Sensors 모듈 문서](docs/sensors.md)
- [Vision 모듈 문서](docs/vision.md)
