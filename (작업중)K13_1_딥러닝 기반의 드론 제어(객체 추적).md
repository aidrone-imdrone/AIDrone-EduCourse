
# 물체 추적 드론 시스템 사용 설명서

이 문서는, 라즈베리파이 Zero 2W 기반 미니 드론에서 사용자가 선택한 물체를 자동으로 추적하는 시스템의 설치 및 사용 방법을 설명합니다.

![드론 물체 추적 예시](https://github.com/user-attachments/assets/placeholder-tracking-image.jpg)

## 시스템 개요

이 시스템은 다음 두 가지 주요 구성 요소로 이루어져 있습니다:

1. **라즈베리파이 드론 컨트롤러** (`object_tracking_drone.py`): 라즈베리파이에서 실행되며 드론을 제어하고 물체를 추적합니다.
2. **PC 물체 선택 클라이언트** (`pc_object_selector.py`): PC에서 실행되며 사용자가 추적할 물체를 선택하고 추적 명령을 드론에 전송합니다.

시스템은 mjpg-streamer를 통해 비디오 스트리밍을 제공하며, 물체의 HSV 색상 범위를 기반으로 추적합니다.

## 요구사항

### 하드웨어 요구사항
- 라즈베리파이 Zero 2W
- 라즈베리파이 카메라 모듈
- 8520 DC 모터 기반 미니 드론
- 드론-라즈베리파이 연결 케이블

### 소프트웨어 요구사항
- 라즈베리파이
  - Raspberry Pi OS
  - Python 3.7 이상
  - OpenCV
  - NumPy
  - pyaidrone 라이브러리
  - mjpg-streamer (설치 및 서비스로 등록됨)
- PC
  - Python 3.7 이상
  - OpenCV
  - NumPy
  - tkinter (GUI용)
  - Pillow

## 설치 방법

### 라즈베리파이 설정

1. 필요한 패키지 설치:
```bash
sudo apt update
sudo apt install -y python3-pip python3-opencv python3-numpy
pip3 install opencv-python-headless numpy
```

2. mjpg-streamer가 실행 중인지 확인:
```bash
sudo systemctl status mjpg-streamer.service
```

3. 드론 물체 추적 코드 다운로드:
```bash
git clone https://github.com/yourusername/drone-object-tracking.git
cd drone-object-tracking
```

### PC 설정

1. 필요한 패키지 설치:
```bash
pip install opencv-python numpy pillow
```

2. PC 클라이언트 코드 다운로드:
```bash
git clone https://github.com/yourusername/drone-object-tracking.git
cd drone-object-tracking
```

## 사용 방법

### 1. 라즈베리파이에서 물체 추적 드론 서버 실행

라즈베리파이에 SSH로 연결한 후 다음 명령을 실행:

```bash
cd ~/drone-object-tracking
python3 object_tracking_drone.py
```

추가 옵션:
```bash
# 시뮬레이션 모드(드론 없이 테스트)
python3 object_tracking_drone.py --simulation

# 다른 포트나 URL 설정
python3 object_tracking_drone.py --mjpg-url http://localhost:8080/?action=stream --cmd-port 8081 --port /dev/serial0
```

프로그램이 시작되면 라즈베리파이의 IP 주소와 포트 번호를 확인하세요.

### 2. PC에서 물체 선택 클라이언트 실행

PC에서 다음 명령을 실행:

```bash
cd drone-object-tracking
python pc_object_selector.py
```

### 3. 드론에 연결

PC 클라이언트 GUI에서:

1. 라즈베리파이 IP 주소와 포트를 입력합니다.
2. "연결" 버튼을 클릭합니다.
3. 연결이 성공하면 "연결됨" 메시지가 표시됩니다.

### 4. 물체 선택 및 추적

1. 비디오 스트림에서 추적하려는 물체를 마우스로 드래그하여 선택합니다.
2. 선택한 물체의 색상이 자동으로 분석되고 HSV 색상 범위가 표시됩니다.
3. 필요한 경우 HSV 슬라이더를 조정하여 물체 감지 범위를 조정합니다.
4. "추적 시작" 버튼을 클릭합니다.
5. 드론이 선택한 물체를 자동으로 추적하기 시작합니다.

### 5. 추적 중지

추적을 중지하려면 "추적 중지" 버튼을 클릭합니다.

## 코드 구조

### 라즈베리파이 코드 (`object_tracking_drone.py`)

```
object_tracking_drone.py
├── 메인 함수
├── ObjectTrackingDrone 클래스
│   ├── open_mjpg_stream(): mjpg-streamer 연결
│   ├── read_mjpg_frame(): 비디오 프레임 읽기
│   ├── detect_object(): HSV 색상 기반 물체 감지
│   ├── control_drone(): 드론 제어 로직
│   └── run(): 메인 루프
└── CommandServer 클래스: PC로부터 명령 수신
```

### PC 클라이언트 코드 (`pc_object_selector.py`)

```
pc_object_selector.py
├── 메인 함수
└── DroneObjectSelector 클래스
    ├── create_widgets(): GUI 구성
    ├── connect_to_drone(): 드론 연결
    ├── select_object(): 물체 선택 처리
    ├── analyze_selection(): 선택된 영역 색상 분석
    ├── start_tracking(): 추적 명령 전송
    └── stream_video(): 비디오 스트림 처리
```

## 작동 원리

1. **물체 선택**: 사용자가 PC 클라이언트에서 추적할 물체를 선택합니다.
2. **색상 분석**: 선택된 영역의 HSV 색상 범위가 분석됩니다.
3. **추적 명령**: PC 클라이언트가 HSV 색상 범위와 추적 명령을 드론으로 전송합니다.
4. **물체 감지**: 드론은 받은 HSV 색상 범위를 사용하여 카메라 영상에서 물체를 감지합니다.
5. **드론 제어**: 드론은 감지된 물체의 위치에 따라 자동으로 이동하여 물체를 추적합니다.

## 문제 해결

### 연결 문제
- 라즈베리파이 IP 주소와 포트가 올바른지 확인하세요.
- mjpg-streamer가 실행 중인지 확인하세요.
- 방화벽 설정을 확인하세요.

### 물체 감지 문제
- HSV 슬라이더를 조정하여 색상 범위를 조정해보세요.
- 조명 조건이 적절한지 확인하세요.
- 물체와 배경의 색상 대비가 충분한지 확인하세요.

### 드론 제어 문제
- 시리얼 포트가 올바르게 설정되었는지 확인하세요.
- 드론 배터리 상태를 확인하세요.
- 시뮬레이션 모드에서 먼저 테스트해보세요.

## 고급 설정

### HSV 값 미세 조정
HSV(Hue, Saturation, Value) 값을 조정하여 다양한 조명 환경과 물체 색상에 맞게 감지 범위를 최적화할 수 있습니다:

- **H(Hue)**: 색상을 나타냅니다 (0-179).
- **S(Saturation)**: 색의 순도를 나타냅니다 (0-255).
- **V(Value)**: 밝기를 나타냅니다 (0-255).

### 데드존 조정
드론의 안정적인 추적을 위해 데드존(물체가 중앙에 있다고 간주되는 영역) 크기를 조정할 수 있습니다:

```python
# 라즈베리파이 코드에서
self.dead_zone = 50  # 값을 조정하여 데드존 크기 변경
```

## 라이선스

이 프로젝트는 MIT 라이선스 하에 제공됩니다.

## 기여

이슈 등록이나 풀 리퀘스트를 통해 이 프로젝트에 기여할 수 있습니다.
